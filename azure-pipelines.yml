# Methane Kit CI configuration
# https://aka.ms/yaml

trigger:
  branches:
    include:
    - master
    - develop
  paths:
    exclude:
    - README.md
    - LICENSE
    - CMakeSettings.json

pr:
  branches:
    include:
    - master
  paths:
    exclude:
    - README.md
    - LICENSE
    - CMakeSettings.json

resources:
  repositories:
  - repository: self
    checkoutOptions:
      submodules: recursive

jobs:

- job: Windows_x64

  pool:
    vmImage: 'vs2017-win2016'

  variables:
    platform: 'Win64'
    configuration: 'Release'
    vcVarsBatFile: 'vcvars64.bat'
    generatorName: '"Visual Studio 15 2017 Win64"'
    cmakeFlags: '-DMETHANE_ITT_INSTRUMENTATION_ENABLED:BOOL=ON -DMETHANE_SHADERS_CODEVIEW_ENABLED:BOOL=ON -DMETHANE_RUN_TESTS_DURING_BUILD:BOOL=OFF -DMETHANE_BUILD_NUMBER=${Build.BuildNumber}'
    buildName: '$(platform)-$(configuration)'
    buildDir: 'Build\Output\$(buildName)\Build'
    installDir: 'Build\Output\$(buildName)\Install'
    buildInstallDir: '..\Install'
    rootDir: '..\..\..\..'

  steps:
  - template: Build/Windows/AzureBuild.yml

- job: Windows_x86

  pool:
    vmImage: 'vs2017-win2016'

  variables:
    platform: 'Win32'
    configuration: 'Release'
    vcVarsBatFile: 'vcvars32.bat'
    generatorName: '"Visual Studio 15 2017"'
    cmakeFlags: '-DMETHANE_ITT_INSTRUMENTATION_ENABLED:BOOL=ON -DMETHANE_SHADERS_CODEVIEW_ENABLED:BOOL=ON -DMETHANE_RUN_TESTS_DURING_BUILD:BOOL=OFF -DMETHANE_BUILD_NUMBER=${Build.BuildNumber}'
    buildName: '$(platform)-$(configuration)'
    buildDir: 'Build\Output\$(buildName)\Build'
    installDir: 'Build\Output\$(buildName)\Install'
    buildInstallDir: '..\Install'
    rootDir: '..\..\..\..'

  steps:
  - template: Build/Windows/AzureBuild.yml

- job: macOS

  pool:
    vmImage: 'macOS-10.13'

  variables:
    platform: 'MacOS'
    configuration: 'Release'
    generatorName: 'Xcode'
    cmakeFlags: '-DMETHANE_ITT_INSTRUMENTATION_ENABLED:BOOL=ON -DMETHANE_SHADERS_CODEVIEW_ENABLED:BOOL=ON -DMETHANE_RUN_TESTS_DURING_BUILD:BOOL=OFF -DMETHANE_BUILD_NUMBER=${Build.BuildNumber}'
    buildName: '$(platform)-$(configuration)'
    buildDir: 'Build/Output/$(buildName)/Build'
    installDir: 'Build/Output/$(buildName)/Install'
    buildInstallDir: '../Install'
    rootDir: '../../../..'

  steps:
  - template: Build/MacOS/AzureBuild.yml