# Methane Kit CI configuration for MacOS platform
# https://aka.ms/yaml

steps:

  - script: |
      mkdir $(buildDir)
    displayName: 'Make build directories for $(buildName)'

  - task: CMake@1
    displayName: 'Generate with $(generatorName) for $(generatorName) $(configuration)'
    inputs:
      workingDirectory: $(buildDir)
      cmakeArgs: '-G $(generatorName) -DCMAKE_BUILD_TYPE=$(configuration) -DCMAKE_INSTALL_PREFIX:PATH=$(buildInstallDir) $(cmakeFlags) $(rootDir)'

  - task: CMake@1
    displayName: 'Build with $(generatorName) $(configuration)'
    inputs:
      workingDirectory: $(buildDir)
      cmakeArgs: '--build . --config $(configuration) --target install'

  - task: CopyFiles@2
    displayName: 'Copy install artifacts for $(buildName)'
    inputs:
      SourceFolder: $(installDir)
      Contents: '**/*'
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish install artifacts for $(buildName)'
    inputs:
      pathtoPublish: '$(Build.ArtifactStagingDirectory)'
      artifactName: MethaneKit-$(buildName)